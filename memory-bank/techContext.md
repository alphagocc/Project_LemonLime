# Tech Context - 技术上下文

## 核心技术栈

### 1. 主要框架与库
- **Qt Framework**: 5.15 和 6.2 - 跨平台GUI应用程序框架
  - QtCore: 核心非GUI功能
  - QtGui: 图形用户界面组件
  - QtWidgets: 桌面应用程序UI组件
  - QtConcurrent: 多线程和并发编程
  - QtLinguist: 国际化支持

- **CMake**: 3.16+ - 跨平台构建系统
  - 现代化的构建配置管理
  - 自动依赖检测和配置
  - 多平台编译支持

- **spdlog**: 1.x - 高性能日志库
  - 异步日志记录
  - 多目标输出支持
  - 格式化输出和级别控制

- **SingleApplication**: 第三方库 - 单实例应用程序支持
  - 防止多个实例同时运行
  - 实例间通信支持

### 2. 编程语言
- **C++**: 17/20标准
  - 面向对象设计
  - RAII资源管理
  - 智能指针和现代化特性
  - 模板元编程

- **Qt Meta-Object System**: 信号槽机制
  - 运行时类型信息
  - 动态属性系统
  - 国际化支持

### 3. 数据格式与序列化
- **JSON**: Qt内置JSON支持
  - 配置文件存储
  - 数据交换格式
  - 比赛项目持久化

- **二进制格式**: QDataStream
  - 高效的二进制序列化
  - 版本兼容性处理
  - 快速数据读写

## 开发环境配置

### 1. 构建环境要求
```bash
# 最小系统要求
操作系统: Windows 10+/Ubuntu 20.04+/macOS 10.14+
编译器: MSVC 2019+/GCC 9+/Clang 10+
CMake: 3.16+
Qt: 5.15 或 6.2 (明确版本限制)

# 依赖库安装
- Qt 5.15 Development Tools
- Qt 6.2 Development Tools
- CMake Build System
- Git Version Control
- C++ Compiler Toolchain
```

### 2. 开发工具链
- **IDE支持**:
  - Qt Creator (推荐)
  - Visual Studio (Windows)
  - CLion (跨平台)
  - VSCode + Qt插件

- **调试工具**:
  - Qt Creator内置调试器
  - GDB/LLDB (Linux/macOS)
  - WinDbg (Windows)
  - Valgrind (内存检测)

- **性能分析**:
  - Qt Creator性能分析器
  - Intel VTune
  - Perf (Linux)
  - Windows Performance Toolkit

### 3. 版本控制与协作
- **Git**: 分布式版本控制
  - 分支管理策略
  - 代码审查流程
  - 持续集成集成

- **代码规范**:
  - .clang-format: 代码格式化规则
  - .clang-tidy: 静态代码分析
  - 代码审查检查清单

## 平台特定技术

### 1. Windows平台
- **Win32 API**: 进程和文件系统管理
- **Windows Sandbox**: 程序隔离执行
- **Job Objects**: 资源限制和管理
- **ACL**: 文件权限控制

### 2. Linux平台 (Ubuntu 20.04重点支持)
- **POSIX**: 标准进程管理接口
- **cgroups**: 资源限制和控制
- **prlimit64**: 系统资源限制
- **chroot**: 文件系统隔离

### 3. macOS平台
- **POSIX**: 标准接口支持
- **App Sandbox**: 应用程序沙箱
- **Launch Services**: 程序执行管理

## 性能与优化技术

### 1. 内存管理
- **对象池**: 频繁创建销毁的对象复用
- **智能指针**: 自动内存管理
- **内存映射文件**: 大文件高效处理
- **缓存策略**: 测试用例和编译结果缓存

### 2. 并发处理
- **线程池**: 限制最大线程数，避免资源耗尽
- **任务队列**: 评测任务的有序调度
- **原子操作**: 线程安全的状态更新
- **读写锁**: 配置数据的高效访问

### 3. I/O优化
- **异步I/O**: 非阻塞文件操作
- **缓冲策略**: 减少系统调用次数
- **批量处理**: 合并多个小操作
- **临时文件管理**: 高效的临时文件创建和清理

## 安全与隔离技术

### 1. 程序隔离
- **沙箱执行**: 限制程序文件系统访问
- **资源限制**: CPU时间、内存使用限制
- **权限控制**: 最小权限原则
- **输入验证**: 防止恶意输入

### 2. 数据保护
- **文件权限**: 保护测试数据和结果
- **临时文件**: 安全的临时文件处理
- **内存保护**: 防止内存泄露和越界
- **日志审计**: 完整的操作记录

## 国际化技术

### 1. 多语言支持
- **Qt Linguist**: 专业翻译工具集成
- **运行时切换**: 动态语言切换支持
- **Unicode**: 完整的Unicode字符支持
- **区域设置**: 本地化格式适配

### 2. 文本处理
- **编码检测**: 自动文本编码识别
- **双向文本**: 支持从右到左的文本
- **字体渲染**: 多语言字体支持
- **输入法**: 集成系统输入法支持

## 测试与质量保证

### 1. 测试策略
- **单元测试**: 核心功能模块测试
- **集成测试**: 组件间交互测试
- **系统测试**: 端到端功能验证
- **性能测试**: 负载和压力测试

### 2. 代码质量
- **静态分析**: clang-tidy代码检查
- **动态分析**: 内存泄漏检测
- **代码覆盖**: 测试覆盖率分析
- **持续集成**: 自动化构建和测试

## 部署与分发

### 1. 构建配置
- **Release/Debug**: 不同构建类型配置
- **静态/动态链接**: Qt库链接方式选择
- **符号文件**: 调试信息处理
- **优化级别**: 编译器优化设置

### 2. 打包分发
- **Windows**: MSI安装包或ZIP压缩包
- **Linux**: AppImage或DEB包 (Ubuntu 20.04)
- **macOS**: DMG磁盘映像
- **跨平台**: 源码分发和构建说明

## 监控与诊断

### 1. 日志系统
- **分级日志**: DEBUG/INFO/WARN/ERROR级别
- **结构化日志**: JSON格式日志输出
- **日志轮转**: 自动日志文件管理
- **本地日志**: 专注于单机环境下的日志记录

### 2. 性能监控
- **指标收集**: 关键性能指标监控
- **资源使用**: CPU、内存、磁盘使用跟踪
- **评测统计**: 评测任务执行统计
- **错误追踪**: 异常和错误信息收集

## 架构原则

### 1. 单机优先设计
- **无网络依赖**: 完全离线运行能力
- **本地资源**: 充分利用本地计算资源
- **简化部署**: 最小化外部依赖
- **性能优化**: 针对单机性能进行优化

### 2. 稳定性优先
- **错误恢复**: 完善的错误处理机制
- **资源管理**: 防止资源泄漏和耗尽
- **状态一致性**: 确保数据状态的一致性
- **降级策略**: 故障时的优雅降级

### 3. 用户体验优先
- **响应速度**: 快速的界面响应
- **直观操作**: 简洁明了的用户界面
- **实时反馈**: 及时的状态更新和提示
- **错误提示**: 清晰的错误信息和解决方案
